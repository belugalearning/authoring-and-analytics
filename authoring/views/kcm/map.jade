extends layout

block additionalScripts
  script
    var kcm = !{JSON.stringify(map,null,2)}
  script(src='/javascripts/kcm/jquery.tmpl.js', type='text/javascript')
  script(src='/javascripts/kcm/d3.v2.NC-BRANCH.min.js', type='text/javascript')
  script(src='/javascripts/kcm/jquery.form.js', type='text/javascript')
  script(src='/javascripts/kcm/kcm.js', type='text/javascript')

block wrapper
  #right-panel
    table(data-panel="view-settings")
      thead
        tr
          th(colspan="2")
            | View Settings
      tbody
        tr.field
          td.field-label Links
          td.field-data
            table#links-view-settings
              thead
                tr
                  th.br-name Name
                  th.br-visible Visible
                  th.br-colour Colour
              tbody
    table.none-selected(data-panel="concept-node-data")
      thead
        tr
          th(colspan="2")
            | Concept Node Properties
      tbody
        tr.field
          td.field-label Db Id:
          td.field-data
            span#concept-db-id
        tr.field
          td.field-label Description:
          td.field-data
            textarea#concept-description(disabled='disabled', rows='10')
        tr.field
          td.field-label Tags:
            br
            div#insert-tag-btn.add-btn.panel-left-btn
          td.field-data
            div#concept-tags
        tr.field
          td(colspan='2')
            | Pipelines:
            br
            div#insert-pipeline-btn.add-btn.panel-left-btn
            table(data-section="pipelines")
    table(data-panel="export-settings")
      thead
        tr
          th
            | Export Settings
      tbody
        tr.field
          td(style="text-align:right")
            a(href='/kcm/get-app-canned-databases') Export KCM
        tr.field(data-key="nodeExclusionTags", data-type="tag")
          td
            div.add-btn.panel-right-btn
            | Exclude All Nodes Tagged:
            div.tags-box.empty
        tr.field(data-key="conceptNodeRequiredTags", data-type="tag")
          td
            div.add-btn.panel-right-btn
            | Require Concept Node Tags:
            div.tags-box.empty
        if map.user.devteam
          tr.field
            td
              input#export-all-nodes(type="checkbox")
              | Include Every Other Node
          tr.field(data-key="nodeInclusionTags", data-type="tag")
            td
              div.add-btn.panel-right-btn
              | Include All Other Nodes Tagged:
              div.tags-box.empty
          tr.field(data-key="nodeTagsToBitCols", data-type="tag")
            td
              div.add-btn.panel-right-btn
              | Tags To Bit Cols:
              div#tags-to-bit-cols.tags-box.empty
          tr.field(data-key="nodeTagPrefixesToTextCols", data-type="tag")
            td
              div#add-tag-prefix-to-text-col.add-btn.panel-right-btn
              | Tag Prefixes To Text Cols:
              div#tag-prefixes-to-text-cols.tags-box.empty
        tr.field(data-key="pipelineNames", data-type="tag")
          td
            div#add-pipeline-to-export.add-btn.panel-right-btn
            | Pipeline Names:
            div#included-pipelines.tags-box.empty
        tr.field(data-key="pipelineWorkflowStatus")
          td
            | Pipeline Workflow Status:
            br
            select(data-key="pipelineWorkflowStatusOperator")
              option(value="<=") <=
              option(value="==") == 
              option(value=">=") >=
            select(data-key="pipelineWorkflowStatusLevel")
              each wfs in map.pipelineWorkflowStatuses
                option(value="#{wfs.value}") #{wfs.name}
    table(data-panel="upload-pipeline-folder")
      thead
        tr
          th
            | Upload Pipeline Folder
      tbody
        tr.field
          td
            div#file-holder
              div.folder-icon
              input#file-url(type="file", multiple, webkitdirectory, directory)
    form(id="upload-pdefs", action="/kcm/add-problems-to-pipeline", method="post", style="visibility:hidden;")
      input(type="text", name="pipeline-id")
      input(type="text", name="pipeline-rev")
      input(type="text", name="concept-node-id")
      input(type="text", name="concept-node-rev")
      input(type="file", multiple="multiple", name="pdefs", id="pdefs")
